# AgentCarRepair Application Architecture

![Solution Architecture](RepairAgent-SolutionArchitecture.png)

--- 

## 🏗️ System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           USER INTERACTION LAYER                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐           │
│  │   Desktop   │  │   Mobile    │  │   Tablet    │  │  API Client │           │
│  │   Browser   │  │   Browser   │  │   Browser   │  │    (curl)   │           │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘           │
│            │              │              │              │                     │
│            └──────────────┼──────────────┼──────────────┘                     │
│                          │              │                                     │
│                     HTTP/HTTPS Requests                                       │
│                          │              │                                     │
└─────────────────────────────────────────────────────────────────────────────────┘
                            │              │
                            ▼              ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        WEB APPLICATION LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                          Flask Web Server                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                       AgentRepair.py                                   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │    Route    │  │    Route    │  │    Route    │  │    Route    │  │   │
│  │  │      /      │  │ /api/chat   │  │ /api/status │  │/api/new-conv│  │   │
│  │  │  (index)    │  │  (chat)     │  │  (health)   │  │(reset chat) │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  │                                                                     │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │   │
│  │  │                  Session Management                              │  │   │
│  │  │  - Thread ID persistence                                        │  │   │
│  │  │  - User session state                                           │  │   │
│  │  │  - Conversation context                                         │  │   │
│  │  └─────────────────────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                     Template Engine (Jinja2)                           │   │
│  │  ┌─────────────┐              ┌─────────────┐                         │   │
│  │  │ chat.html   │              │ error.html  │                         │   │
│  │  │ - Main UI   │              │ - Error UI  │                         │   │
│  │  │ - Chat Intf │              │ - Config    │                         │   │
│  │  │ - Real-time │              │   Help      │                         │   │
│  │  └─────────────┘              └─────────────┘                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                     AUTHENTICATION LAYER                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                     OpenAI API Authentication                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      API Key Management                                 │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │  OpenAI     │  │ Environment │  │   Request   │  │    Rate     │  │   │
│  │  │  API Key    │  │  Variable   │  │  Headers    │  │  Limiting   │  │   │
│  │  │ Validation  │  │  Loading    │  │ Management  │  │ & Retries   │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                               │
│  Environment Variables:                                                       │
│  - OPENAI_API_KEY (Required)                                                 │
│  - FLASK_SECRET_KEY (Optional)                                               │
│  - FLASK_DEBUG (Optional)                                                    │
└─────────────────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         OPENAI CLOUD LAYER                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                          OpenAI Platform                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        OpenAI Client                                   │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │Chat Model   │  │Conversation │  │  Message    │  │  Response   │  │   │
│  │  │ Selection   │  │  Context    │  │ Formatting  │  │ Processing  │  │   │
│  │  │(GPT-4o-mini)│  │ Management  │  │             │  │             │  │   │
│  │  │             │  │             │  │             │  │             │  │   │
│  │  │ - Model     │  │ - History   │  │ - System    │  │ - Content   │  │   │
│  │  │   Config    │  │   Tracking  │  │   Prompts   │  │ Extraction  │  │   │
│  │  │ - Params    │  │ - Session   │  │ - User      │  │ - HTML      │  │   │
│  │  │ - Tokens    │  │   State     │  │   Messages  │  │ Formatting  │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                    │                                           │
│                                    ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                     Car Repair AI System                               │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                    Built-in Knowledge                           │   │   │
│  │  │                                                                 │   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │   │   │
│  │  │  │   GPT-4o    │  │   System    │  │ Automotive  │            │   │   │
│  │  │  │   Model     │  │  Prompts    │  │ Expertise   │            │   │   │
│  │  │  │             │  │             │  │             │            │   │   │
│  │  │  │ - Pre-      │  │ - Expert    │  │ - Diagnosis │            │   │   │
│  │  │  │   trained   │  │   Mechanic  │  │ - Repair    │            │   │   │
│  │  │  │ - Automotive│  │   Role      │  │   Steps     │            │   │   │
│  │  │  │   Knowledge │  │ - Safety    │  │ - Safety    │            │   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘            │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         SESSION STORAGE LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                      Flask Session Management                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    In-Memory Session Storage                           │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │   │
│  │  │Conversation │  │  Message    │  │   Session   │  │   Request   │  │   │
│  │  │  History    │  │   Context   │  │    State    │  │   Tracking  │  │   │
│  │  │             │  │             │  │             │  │             │  │   │
│  │  │ - User      │  │ - Formatted │  │ - Conversation│ │ - Timestamps│  │   │
│  │  │   Messages  │  │   Responses │  │    IDs      │  │ - User      │  │   │
│  │  │ - Assistant │  │ - HTML      │  │ - Session   │  │   Sessions  │  │   │
│  │  │   Replies   │  │   Content   │  │   Keys      │  │ - Request   │  │   │
│  │  │ - Context   │  │ - Raw Text  │  │ - Secure    │  │   Logging   │  │   │
│  │  │   Limit     │  │             │  │   Storage   │  │             │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 Data Flow Architecture

```
USER REQUEST FLOW:
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Browser   │───▶│    Flask    │───▶│   OpenAI    │───▶│  GPT-4o     │
│             │    │   Server    │    │   Client    │    │   Model     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       ▲                   │                   │                   │
       │                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Formatted  │◀───│   Session   │    │   OpenAI    │───▶│  Built-in   │
│  Response   │    │ Management  │    │     API     │    │  Knowledge  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

CONVERSATION FLOW:
1. User sends message via web interface
2. Flask server validates session and environment
3. OpenAI API key authentication
4. OpenAI client initialization
5. Conversation context management
6. System prompt and message formatting
7. GPT-4o-mini API request and response
8. HTML formatting and session update
9. JSON response back to user interface
```
